# è®¢é˜…åŠŸèƒ½éƒ¨ç½²æ£€æŸ¥æ¸…å•

## ğŸ“‹ éƒ¨ç½²å‰æ£€æŸ¥

### ä»£ç ä¿®æ”¹
- [x] backend/functions/src/user_handler.ts - æ·»åŠ ä¼šå‘˜é»˜è®¤å­—æ®µ
- [x] backend/functions/src/membership_handler.ts - éªŒè¯å¯¼å‡º
- [x] lib/services/api_service.dart - æ·»åŠ ä¼šå‘˜æ–¹æ³•æ¥å£
- [x] lib/services/firebase_api_service.dart - å®ç°ä¼šå‘˜æ–¹æ³•å’Œæ•°æ®è§£æ
- [x] lib/services/fake_api_service.dart - æ·»åŠ æ¨¡æ‹Ÿå®ç°
- [x] lib/pages/subscribe_page.dart - ä½¿ç”¨ Cloud Function

### æµ‹è¯•éªŒè¯
- [x] åç«¯æ„å»ºæˆåŠŸ (`npm run build`)
- [x] å‰ç«¯åˆ†æé€šè¿‡ (`flutter analyze`)
- [x] è‡ªåŠ¨åŒ–æµ‹è¯•é€šè¿‡ (`./TEST_SUBSCRIPTION.sh`)

---

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### ç¬¬1æ­¥: éƒ¨ç½²åç«¯ Cloud Functions
```bash
cd backend/functions
npm run build
firebase deploy --only functions
```

éƒ¨ç½²å®Œæˆæ£€æŸ¥ï¼š
- [ ] upgradeMembership å‡½æ•°éƒ¨ç½²æˆåŠŸ
- [ ] cancelMembership å‡½æ•°éƒ¨ç½²æˆåŠŸ
- [ ] checkMembershipExpiry å‡½æ•°éƒ¨ç½²æˆåŠŸ
- [ ] æŸ¥çœ‹æ—¥å¿—æ— é”™è¯¯ï¼š`firebase functions:log`

### ç¬¬2æ­¥: æ•°æ®è¿ç§»ï¼ˆå¦‚æœ‰ç°æœ‰ç”¨æˆ·ï¼‰
```bash
node scripts/migrate_membership_fields.js
```

è¿ç§»å®Œæˆæ£€æŸ¥ï¼š
- [ ] è„šæœ¬æˆåŠŸè¿è¡Œ
- [ ] æ‰€æœ‰ç”¨æˆ·éƒ½æœ‰ membershipTier å­—æ®µ
- [ ] Firebase Console éªŒè¯æ•°æ®

### ç¬¬3æ­¥: å‰ç«¯æµ‹è¯•
```bash
flutter run -d chrome
```

åŠŸèƒ½æµ‹è¯•ï¼š
- [ ] æ–°ç”¨æˆ·æ³¨å†Œ â†’ é»˜è®¤ Free tier âœ“
- [ ] å¯¼èˆªåˆ°è®¢é˜…é¡µé¢ âœ“
- [ ] æŸ¥çœ‹å½“å‰ä¼šå‘˜çŠ¶æ€ âœ“
- [ ] é€‰æ‹© Premium å¥—é¤ âœ“
- [ ] ç¡®è®¤å¹¶è®¢é˜… âœ“
- [ ] è®¢é˜…æˆåŠŸï¼Œæ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯ âœ“
- [ ] è¿”å› Post é¡µé¢ï¼Œæƒé™æ›´æ–° âœ“

---

## ğŸ§ª æµ‹è¯•åœºæ™¯

### åœºæ™¯1: å…è´¹ç”¨æˆ·é™åˆ¶
**å‰ç½®æ¡ä»¶**: ç™»å½•ä¸º Free ç”¨æˆ·

æµ‹è¯•æ­¥éª¤ï¼š
1. [ ] è¿›å…¥ Post é¡µé¢
2. [ ] æŸ¥çœ‹æ˜¯å¦æ˜¾ç¤º "3æ¬¡/å¤©" é™åˆ¶æç¤º
3. [ ] å°è¯•è§£é”3ä¸ªå¸–å­
4. [ ] ç¬¬4æ¬¡è§£é”æ—¶ï¼Œæ˜¾ç¤ºå‡çº§æç¤º
5. [ ] ç‚¹å‡»"å‡çº§"æŒ‰é’®ï¼Œè·³è½¬åˆ°è®¢é˜…é¡µé¢

é¢„æœŸç»“æœï¼šâœ… æ‰€æœ‰æ­¥éª¤æŒ‰é¢„æœŸæ‰§è¡Œ

---

### åœºæ™¯2: Premium ç”¨æˆ·æƒé™
**å‰ç½®æ¡ä»¶**: è®¢é˜… Premium

æµ‹è¯•æ­¥éª¤ï¼š
1. [ ] å®Œæˆè®¢é˜…æµç¨‹
2. [ ] è¿›å…¥ Post é¡µé¢
3. [ ] éªŒè¯ä¸æ˜¾ç¤ºè§£é”é™åˆ¶
4. [ ] å°è¯•è§£é”å¤šä¸ªå¸–å­ï¼ˆ>3ä¸ªï¼‰
5. [ ] æ‰€æœ‰å¸–å­éƒ½èƒ½æ­£å¸¸è§£é”

é¢„æœŸç»“æœï¼šâœ… æ— é™åˆ¶è§£é”

---

### åœºæ™¯3: çŠ¶æ€åŒæ­¥
**å‰ç½®æ¡ä»¶**: æ–°è®¢é˜…çš„ Premium ç”¨æˆ·

æµ‹è¯•æ­¥éª¤ï¼š
1. [ ] åœ¨è®¢é˜…é¡µé¢å®Œæˆè®¢é˜…
2. [ ] å¯¼èˆªåˆ°ä¸ªäººèµ„æ–™é¡µé¢
3. [ ] æ£€æŸ¥æ˜¾ç¤º Premium çŠ¶æ€
4. [ ] å¯¼èˆªåˆ° Post é¡µé¢
5. [ ] æ£€æŸ¥æƒé™æ­£ç¡®ï¼ˆæ— é™åˆ¶ï¼‰
6. [ ] åˆ·æ–°é¡µé¢
7. [ ] çŠ¶æ€ä»ç„¶ä¿æŒ

é¢„æœŸç»“æœï¼šâœ… è·¨é¡µé¢å’Œåˆ·æ–°åçŠ¶æ€ä¸€è‡´

---

### åœºæ™¯4: ä¼šå‘˜è¿‡æœŸ
**å‰ç½®æ¡ä»¶**: æ‰‹åŠ¨è®¾ç½®å·²è¿‡æœŸçš„ä¼šå‘˜

æµ‹è¯•æ­¥éª¤ï¼š
1. [ ] Firebase Console è®¾ç½® membershipExpiry ä¸ºè¿‡å»æ—¶é—´
2. [ ] åˆ·æ–°åº”ç”¨
3. [ ] åŠ è½½ç”¨æˆ·æ•°æ®
4. [ ] æ£€æŸ¥ `effectiveTier` è¿”å› Free
5. [ ] Post é¡µé¢æ˜¾ç¤ºé™åˆ¶

é¢„æœŸç»“æœï¼šâœ… è¿‡æœŸä¼šå‘˜è‡ªåŠ¨é™çº§ä¸º Free

---

## ğŸ” éªŒè¯æ£€æŸ¥

### Firebase Console æ£€æŸ¥
1. [ ] Firestore â†’ users é›†åˆ
   - [ ] æ‰€æœ‰ç”¨æˆ·æœ‰ membershipTier å­—æ®µ
   - [ ] æ‰€æœ‰ç”¨æˆ·æœ‰ membershipExpiry å­—æ®µ
   - [ ] æ‰€æœ‰ç”¨æˆ·æœ‰ subscriptionId å­—æ®µ

2. [ ] Firestore â†’ users/{userId}/subscriptions
   - [ ] è®¢é˜…ç”¨æˆ·æœ‰è®¢é˜…è®°å½•
   - [ ] è®°å½•åŒ…å«å®Œæ•´ä¿¡æ¯ï¼ˆtier, dates, statusï¼‰

3. [ ] Firestore â†’ auditLogs
   - [ ] æœ‰ membership_upgraded æ—¥å¿—
   - [ ] æ—¥å¿—åŒ…å«å®Œæ•´ä¿¡æ¯ï¼ˆactorId, timestamp, detailsï¼‰

4. [ ] Functions â†’ ä½¿ç”¨æƒ…å†µ
   - [ ] upgradeMembership æœ‰è°ƒç”¨è®°å½•
   - [ ] è°ƒç”¨æˆåŠŸç‡ 100%

---

### æ—¥å¿—æ£€æŸ¥

#### åç«¯æ—¥å¿—
```bash
firebase functions:log --only upgradeMembership
```

æœŸæœ›çœ‹åˆ°ï¼š
```
âœ… User xxx upgraded to premium
âœ… Successfully generated subscription record
```

#### å‰ç«¯æ—¥å¿—
åœ¨ Flutter DevTools Console æœŸæœ›çœ‹åˆ°ï¼š
```
ğŸ”„ [SUBSCRIBE] Upgrading membership via Cloud Function...
âœ… [SUBSCRIBE] Membership upgraded successfully
âœ… [POST_PAGE] State updated with membership: premium
```

---

## ğŸ“Š æ€§èƒ½åŸºå‡†

### è®¢é˜…æµç¨‹æ—¶é—´
- [ ] ç‚¹å‡»è®¢é˜…åˆ°çœ‹åˆ°æˆåŠŸæ¶ˆæ¯ï¼š< 5ç§’
- [ ] çŠ¶æ€æ›´æ–°åæ˜ åˆ°UIï¼š< 2ç§’
- [ ] è·¨é¡µé¢çŠ¶æ€åŒæ­¥ï¼šç«‹å³

### Cloud Function æ€§èƒ½
- [ ] upgradeMembership æ‰§è¡Œæ—¶é—´ï¼š< 2ç§’
- [ ] æ•°æ®åº“å†™å…¥æ—¶é—´ï¼š< 1ç§’

---

## ğŸ› é—®é¢˜æ’æŸ¥æ¸…å•

å¦‚æœé‡åˆ°é—®é¢˜ï¼ŒæŒ‰é¡ºåºæ£€æŸ¥ï¼š

### 1. Cloud Function é—®é¢˜
- [ ] å‡½æ•°å·²éƒ¨ç½²ï¼š`firebase functions:list`
- [ ] å‡½æ•°æ—¥å¿—æ— é”™è¯¯ï¼š`firebase functions:log`
- [ ] è®¤è¯æ­£å¸¸ï¼šç”¨æˆ·å·²ç™»å½•

### 2. å‰ç«¯çŠ¶æ€é—®é¢˜
- [ ] è®¢é˜…åè°ƒç”¨äº† `_loadCurrentUser()`
- [ ] ä½¿ç”¨ `effectiveTier` è€Œé `membershipTier`
- [ ] æ—¥å¿—æ˜¾ç¤ºæ­£ç¡®çš„ä¼šå‘˜ç­‰çº§

### 3. æ•°æ®åŒæ­¥é—®é¢˜
- [ ] Firestore æ•°æ®æ­£ç¡®æ›´æ–°
- [ ] å‰ç«¯æ­£ç¡®è§£ææ—¶é—´æˆ³
- [ ] æ²¡æœ‰ç¼“å­˜é—®é¢˜ï¼ˆæ¸…ç©ºå¹¶é‡å¯ï¼‰

---

## âœ… éƒ¨ç½²æˆåŠŸæ ‡å‡†

æ‰€æœ‰ä»¥ä¸‹æ¡ä»¶éƒ½æ»¡è¶³æ—¶ï¼Œè®¤ä¸ºéƒ¨ç½²æˆåŠŸï¼š

1. âœ… åç«¯ Cloud Functions éƒ¨ç½²æˆåŠŸ
2. âœ… æ•°æ®è¿ç§»å®Œæˆï¼ˆå¦‚é€‚ç”¨ï¼‰
3. âœ… 4ä¸ªæµ‹è¯•åœºæ™¯å…¨éƒ¨é€šè¿‡
4. âœ… Firebase Console æ•°æ®éªŒè¯é€šè¿‡
5. âœ… æ—¥å¿—æ— é”™è¯¯ä¿¡æ¯
6. âœ… æ€§èƒ½æ»¡è¶³åŸºå‡†
7. âœ… ç”¨æˆ·ä½“éªŒæµç•…

---

## ğŸ“ éƒ¨ç½²è®°å½•

### éƒ¨ç½²ä¿¡æ¯
- **éƒ¨ç½²æ—¥æœŸ**: _____________
- **éƒ¨ç½²äººå‘˜**: _____________
- **ç¯å¢ƒ**: [ ] å¼€å‘ [ ] æµ‹è¯• [ ] ç”Ÿäº§

### éƒ¨ç½²ç»“æœ
- **Cloud Functions**: [ ] æˆåŠŸ [ ] å¤±è´¥
- **æ•°æ®è¿ç§»**: [ ] æˆåŠŸ [ ] å¤±è´¥ [ ] ä¸é€‚ç”¨
- **åŠŸèƒ½æµ‹è¯•**: [ ] é€šè¿‡ [ ] æœªé€šè¿‡

### é—®é¢˜è®°å½•
_____________________________________
_____________________________________
_____________________________________

### å›æ»šè®¡åˆ’ï¼ˆå¦‚éœ€è¦ï¼‰
_____________________________________
_____________________________________

---

## ğŸ‰ å®Œæˆç¡®è®¤

éƒ¨ç½²å’Œæµ‹è¯•å…¨éƒ¨å®Œæˆåï¼Œåœ¨æ­¤ç­¾åç¡®è®¤ï¼š

**ç¡®è®¤äºº**: _____________
**æ—¥æœŸ**: _____________
**ç­¾å**: _____________

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

éƒ¨ç½²å®Œæˆåï¼Œå»ºè®®é˜…è¯»ï¼š
- [ ] SUBSCRIPTION_QUICK_START.md - å¿«é€Ÿå¯åŠ¨æŒ‡å—
- [ ] SUBSCRIPTION_IMPLEMENTATION_COMPLETE.md - è¯¦ç»†æŠ€æœ¯æ–‡æ¡£
- [ ] SUBSCRIPTION_SUMMARY.md - æ€»ç»“å’Œæœ€ä½³å®è·µ

---

ğŸ’¡ **æç¤º**: å°†æ­¤æ–‡ä»¶æ‰“å°æˆ–ä¿å­˜ä¸º PDFï¼Œåœ¨éƒ¨ç½²æ—¶é€é¡¹æ£€æŸ¥ã€‚
