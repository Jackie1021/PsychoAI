# 实施计划

- [ ] 1. 配置环境变量和 API 密钥管理
  - 更新 `.gitignore` 确保 `.env` 文件不被追踪
  - 验证 `.env.example` 文件包含正确的模板
  - 在 `llm_service.ts` 中添加 dotenv 配置加载
  - 添加 API 密钥验证和友好的错误提示
  - _需求: 2.1, 2.2, 2.3, 2.4, 2.5, 2.6_

- [ ] 2. 创建测试用户数据生成脚本
  - [ ] 2.1 创建 `seed-test-users.js` 脚本文件
    - 定义 11 个特征常量数组（基于 feature_selection_page.dart）
    - 实现随机特征选择函数（每个用户 2-5 个特征）
    - 实现中文自由文本生成函数
    - 创建 15 个测试用户的主函数
    - _需求: 3.2, 3.3, 3.4, 3.6_
  
  - [ ] 2.2 创建模拟器数据填充入口脚本
    - 创建 `seed-emulator-data.js` 文件
    - 配置 Admin SDK 连接到本地模拟器
    - 实现重复检查逻辑（避免重复创建测试用户）
    - 添加执行日志和错误处理
    - _需求: 3.1, 3.5, 3.7, 3.8_

- [ ] 3. 改进 Cloud Functions 错误处理
  - [ ] 3.1 增强 `getMatches` 函数的用户文档处理
    - 实现自动创建缺失的用户文档
    - 添加用户文档验证逻辑
    - _需求: 4.1_
  
  - [ ] 3.2 改进 LLM 服务错误处理
    - 更新 API 密钥错误消息为中文
    - 在 LLM 调用失败时继续处理其他候选人
    - 实现部分结果返回机制
    - 添加全部失败时的描述性错误消息
    - _需求: 4.2, 4.3, 4.4, 4.5_

- [ ] 4. 更新启动脚本
  - 在 `START_BACKEND.sh` 中添加 `.env` 文件检查
  - 实现从 `.env.example` 自动创建 `.env` 的逻辑
  - 添加用户提示信息（如何获取 API Key）
  - 添加依赖检查和清晰的错误消息
  - 在模拟器启动后执行数据填充脚本
  - _需求: 5.1, 5.2, 5.3, 5.4, 5.5, 5.6_

- [ ] 5. 配置 Flutter 应用连接到模拟器
  - 验证 `firebase_api_service.dart` 中的模拟器配置
  - 确保 Cloud Functions 端点指向 `localhost:5002`
  - 测试 `getMatches` 调用路由到本地模拟器
  - _需求: 1.3, 1.5_

- [ ] 6. 添加 package.json 脚本命令
  - 添加 `seed` 命令用于手动填充数据
  - 添加 `clean` 命令清理编译输出
  - 更新 `build` 命令确保正确编译
  - _需求: 5.2_

- [ ] 7. 验证和测试完整工作流
  - [ ] 7.1 测试初次设置流程
    - 验证 `.env` 缺失时的错误提示
    - 测试 API 密钥配置后的正常启动
    - 确认测试用户自动创建
    - _需求: 2.3, 3.8_
  
  - [ ] 7.2 测试匹配功能
    - 从 Flutter 应用调用 `getMatches`
    - 验证 LLM 分析正确执行
    - 确认匹配结果保存到 Firestore
    - 检查前端正确显示匹配结果
    - _需求: 1.3, 1.4_
  
  - [ ] 7.3 测试错误场景
    - 测试无效 API 密钥的错误处理
    - 测试用户文档缺失的自动创建
    - 测试部分 LLM 调用失败的处理
    - _需求: 4.1, 4.2, 4.3_

- [ ] 8. 文档和开发者指南
  - [ ] 8.1 更新 README.md
    - 添加环境设置说明
    - 添加 API 密钥获取指南
    - 添加常见问题解答
    - _需求: 5.6_
  
  - [ ]* 8.2 创建开发者调试指南
    - 记录 Emulator UI 使用方法
    - 添加常见错误排查步骤
    - 提供日志查看指南
