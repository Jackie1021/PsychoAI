# POSTç³»ç»Ÿä¿®å¤ä¸è®¢é˜…åŠŸèƒ½å®Œå–„æŠ€æœ¯æ–¹æ¡ˆ

## ğŸ¯ æ ¸å¿ƒé—®é¢˜åˆ†æ

### é—®é¢˜1ï¼šå°å¡ç‰‡äº¤äº’äº‹ä»¶æ•°æ®æ¨¡å‹æœªæ­£ç¡®æ›´æ–°
**ç°è±¡**ï¼šPostCardå°å¡ç‰‡çš„æ”¶è—å’Œç‚¹èµæŒ‰é’®åœ¨ç‚¹å‡»æ—¶æ— æ³•æ­£ç¡®æ›´æ–°æ•°æ®æ¨¡å‹
**æ ¹æœ¬åŸå› **ï¼š
- PostCardç»„ä»¶å†…éƒ¨ç»´æŠ¤äº†æœ¬åœ°çŠ¶æ€ï¼ˆ_isLiked, _isFavoritedï¼‰ï¼Œä½†å›è°ƒå‡½æ•°æœªä¼ é€’ç»™post_page.dart
- post_page.dartçš„_handleLikeToggleå’Œ_handleFavoriteToggleæœªä½œä¸ºå›è°ƒä¼ é€’ç»™PostCard
- æ•°æ®æ›´æ–°ä»…åœ¨æœ¬åœ°UIï¼ŒæœªåŒæ­¥åˆ°Firebaseå’Œç”¨æˆ·ä¸ªäººèµ„æ–™

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ä¿®æ”¹PostCardï¼Œæ¥æ”¶onLikeToggleå’ŒonFavoriteToggleå›è°ƒ
2. post_page.dartæ­£ç¡®ä¼ é€’å›è°ƒå‡½æ•°
3. ç¡®ä¿ç”¨æˆ·çš„likedPostIdså’ŒfavoritedPostIdsæ­£ç¡®æ›´æ–°

### é—®é¢˜2ï¼šè®¢é˜…åŠŸèƒ½è®¾è®¡ä¸å®Œæ•´
**ç°è±¡**ï¼šç¼–è¾‘èµ„æ–™é¡µé¢çš„è®¢é˜…å…¥å£æ˜¾ç¤º"coming soon"
**å½“å‰çŠ¶æ€**ï¼š
- subscribe_page.dartå·²å­˜åœ¨åŸºç¡€UI
- ç¼ºå°‘å®‰å…¨çš„æ”¯ä»˜æµç¨‹
- æœªé›†æˆçœŸå®æ”¯ä»˜ç½‘å…³

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. å®Œå–„subscribe_page.dartçš„åŠŸèƒ½
2. æ·»åŠ è®¢é˜…çŠ¶æ€ç®¡ç†
3. å®ç°ä¼šå‘˜æƒç›Šå±•ç¤º
4. è®¾è®¡å®‰å…¨çš„è®¢é˜…éªŒè¯æœºåˆ¶ï¼ˆä¸ºæœªæ¥æ”¯ä»˜é›†æˆé¢„ç•™æ¥å£ï¼‰

### é—®é¢˜3ï¼šä¸ªäººèµ„æ–™é¡µé¢æ•°æ®æœªå…³è”
**ç°è±¡**ï¼šç‚¹èµã€æ”¶è—ã€å‘å¸ƒçš„å¸–å­æœªæ­£ç¡®æ˜¾ç¤ºåœ¨profile_page.dart
**æ ¹æœ¬åŸå› **ï¼š
- æ•°æ®æŸ¥è¯¢é€»è¾‘å­˜åœ¨ä½†æœªå®Œå…¨å®ç°
- ç”¨æˆ·æ–‡æ¡£çš„likedPostIdsã€favoritedPostIdsæœªæ­£ç¡®ç»´æŠ¤

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ç¡®ä¿åç«¯æ­£ç¡®æ›´æ–°ç”¨æˆ·çš„å¸–å­IDæ•°ç»„
2. å®ç°getLikedPostså’ŒgetFavoritedPostsæ–¹æ³•
3. æ·»åŠ å®æ—¶æ•°æ®åˆ·æ–°æœºåˆ¶

---

## ğŸ“‹ ä¿®å¤è®¡åˆ’

### é˜¶æ®µ1ï¼šä¿®å¤PostCardäº¤äº’äº‹ä»¶ï¼ˆä¼˜å…ˆçº§ï¼šé«˜ï¼‰
- [x] åˆ†æPostCardå’Œpost_pageæ•°æ®æµ
- [ ] ä¿®æ”¹PostCardæ¥æ”¶å®Œæ•´å›è°ƒ
- [ ] æ›´æ–°post_pageä¼ é€’æ­£ç¡®å›è°ƒ
- [ ] æµ‹è¯•ç‚¹èµå’Œæ”¶è—åŠŸèƒ½
- [ ] éªŒè¯Firebaseæ•°æ®æ­£ç¡®æ›´æ–°

### é˜¶æ®µ2ï¼šå®Œå–„è®¢é˜…é¡µé¢ï¼ˆä¼˜å…ˆçº§ï¼šä¸­ï¼‰
- [ ] å¢å¼ºsubscribe_page UI/UX
- [ ] æ·»åŠ ä¼šå‘˜æƒç›Šå¯¹æ¯”è¡¨
- [ ] å®ç°è®¢é˜…çŠ¶æ€éªŒè¯
- [ ] è¿æ¥edit_profile_pageçš„è®¢é˜…å…¥å£
- [ ] æ·»åŠ è®¢é˜…å†å²è®°å½•æŸ¥çœ‹

### é˜¶æ®µ3ï¼šå…³è”ä¸ªäººèµ„æ–™æ•°æ®ï¼ˆä¼˜å…ˆçº§ï¼šé«˜ï¼‰
- [ ] å®ç°api_serviceçš„getLikedPosts
- [ ] å®ç°api_serviceçš„getFavoritedPosts
- [ ] æµ‹è¯•profile_pageæ•°æ®åŠ è½½
- [ ] æ·»åŠ ä¸‹æ‹‰åˆ·æ–°åŠŸèƒ½
- [ ] ä¼˜åŒ–åŠ è½½æ€§èƒ½

---

## ğŸ”§ æŠ€æœ¯å®ç°ç»†èŠ‚

### PostCardä¿®å¤
```dart
// PostCardéœ€è¦æ¥æ”¶çš„å›è°ƒ
PostCard(
  post: post,
  isMember: _isMember,
  isUnlocked: isUnlocked,
  onUnlock: () => _onUnlockPost(index),
  onLikeToggle: () => _handleLikeToggle(post),      // æ–°å¢
  onFavoriteToggle: () => _handleFavoriteToggle(post), // æ–°å¢
)
```

### è®¢é˜…åŠŸèƒ½å®‰å…¨è®¾è®¡
1. **å‰ç«¯éªŒè¯**ï¼šæ£€æŸ¥ç”¨æˆ·ç™»å½•çŠ¶æ€å’Œå½“å‰ä¼šå‘˜ç­‰çº§
2. **åç«¯éªŒè¯**ï¼šCloud FunctionéªŒè¯è®¢é˜…æœ‰æ•ˆæ€§
3. **æ”¯ä»˜é¢„ç•™æ¥å£**ï¼šä¸ºStripe/æ”¯ä»˜å®ç­‰æ”¯ä»˜ç½‘å…³é¢„ç•™é›†æˆç‚¹
4. **è®¢é˜…çŠ¶æ€åŒæ­¥**ï¼šå®æ—¶æ›´æ–°ç”¨æˆ·çš„membershipTierå’ŒmembershipExpiry

### æ•°æ®æ¨¡å‹æ›´æ–°æµç¨‹
```
ç”¨æˆ·ç‚¹å‡»ç‚¹èµ â†’ PostCardæœ¬åœ°UIæ›´æ–° â†’ è°ƒç”¨onLikeToggleå›è°ƒ
â†’ post_pageè°ƒç”¨apiService.likePost(postId)
â†’ Firebase Cloud Functionå¤„ç†
â†’ æ›´æ–°posts/{postId}/likeså’Œusers/{uid}/likedPostIds
â†’ è¿”å›æˆåŠŸçŠ¶æ€
â†’ å‰ç«¯ä¿æŒUIçŠ¶æ€
```

---

## ğŸš€ éƒ¨ç½²ä¸æµ‹è¯•

### æµ‹è¯•ç”¨ä¾‹
1. **ç‚¹èµåŠŸèƒ½**
   - [ ] ç‚¹èµå¸–å­ï¼ŒéªŒè¯UIå³æ—¶æ›´æ–°
   - [ ] éªŒè¯Firebaseæ•°æ®æ­£ç¡®è®°å½•
   - [ ] ä¸ªäººèµ„æ–™"Liked"æ ‡ç­¾æ˜¾ç¤ºæ­£ç¡®
   - [ ] é‡æ–°ç™»å½•åçŠ¶æ€ä¿æŒ

2. **æ”¶è—åŠŸèƒ½**
   - [ ] æ”¶è—å¸–å­ï¼ŒéªŒè¯æ˜Ÿæ ‡å˜åŒ–
   - [ ] éªŒè¯favoritedPostIdsæ•°ç»„
   - [ ] ä¸ªäººèµ„æ–™"Saved"æ ‡ç­¾æ˜¾ç¤ºæ­£ç¡®

3. **è®¢é˜…åŠŸèƒ½**
   - [ ] æ˜¾ç¤ºå½“å‰è®¢é˜…çŠ¶æ€
   - [ ] é€‰æ‹©ä¸åŒå¥—é¤
   - [ ] æ¨¡æ‹Ÿè®¢é˜…æˆåŠŸæµç¨‹
   - [ ] éªŒè¯ä¼šå‘˜æƒé™ç”Ÿæ•ˆ

### éªŒè¯å‘½ä»¤
```bash
# å¯åŠ¨åç«¯
./START_BACKEND.sh

# è¿è¡Œå‰ç«¯
flutter run -d chrome

# æŸ¥çœ‹æ—¥å¿—
# æ£€æŸ¥Firebase Emulator UI: http://localhost:4000
```

---

## ğŸ“Š æ•°æ®åº“æ¶æ„ç¡®è®¤

### Users Collection
```
users/{uid}
  - likedPostIds: string[]      // ç‚¹èµçš„å¸–å­IDåˆ—è¡¨
  - favoritedPostIds: string[]  // æ”¶è—çš„å¸–å­IDåˆ—è¡¨
  - postsCount: number          // å‘å¸ƒçš„å¸–å­æ•°é‡
  - membershipTier: string      // free | premium | pro
  - membershipExpiry: timestamp
  - subscriptionId: string
```

### Posts Collection
```
posts/{postId}
  - likeCount: number
  - favoriteCount: number
  - commentCount: number
  
  posts/{postId}/likes/{uid}
    - likedAt: timestamp
    
  posts/{postId}/favorites/{uid}
    - favoritedAt: timestamp
```

### Users Subcollectionsï¼ˆç”¨äºå¿«é€ŸæŸ¥è¯¢ï¼‰
```
users/{uid}/likes/{postId}
  - likedAt: timestamp

users/{uid}/favorites/{postId}
  - favoritedAt: timestamp
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æ€§èƒ½ä¼˜åŒ–**ï¼šå¯¹äºç‚¹èµå’Œæ”¶è—æ“ä½œä½¿ç”¨ä¹è§‚UIæ›´æ–°ï¼ˆoptimistic updateï¼‰
2. **é”™è¯¯å¤„ç†**ï¼šç½‘ç»œå¤±è´¥æ—¶å›æ»šUIçŠ¶æ€å¹¶æ˜¾ç¤ºé”™è¯¯æç¤º
3. **æƒé™æ§åˆ¶**ï¼šç¡®ä¿åªæœ‰ç™»å½•ç”¨æˆ·å¯ä»¥ç‚¹èµ/æ”¶è—ï¼Œåªæœ‰ä½œè€…å¯ä»¥åˆ é™¤å¸–å­
4. **è®¢é˜…éªŒè¯**ï¼šæš‚æ—¶ä¸é›†æˆçœŸå®æ”¯ä»˜ï¼Œä½¿ç”¨æ¨¡æ‹Ÿæµç¨‹ï¼Œä½†é¢„ç•™æ”¯ä»˜æ¥å£
5. **æ•°æ®ä¸€è‡´æ€§**ï¼šç¡®ä¿Firebaseæ“ä½œçš„åŸå­æ€§å’Œäº‹åŠ¡ä¸€è‡´æ€§

---

## ğŸ“ åç»­ä¼˜åŒ–æ–¹å‘

1. **ç¼“å­˜æœºåˆ¶**ï¼šæœ¬åœ°ç¼“å­˜ç”¨æˆ·çš„ç‚¹èµ/æ”¶è—åˆ—è¡¨
2. **åˆ†é¡µåŠ è½½**ï¼šä¸ªäººèµ„æ–™é¡µé¢çš„å¸–å­åˆ—è¡¨æ”¯æŒåˆ†é¡µ
3. **å®æ—¶æ›´æ–°**ï¼šä½¿ç”¨Firestoreå®æ—¶ç›‘å¬è®¢é˜…çŠ¶æ€å˜åŒ–
4. **æ”¯ä»˜é›†æˆ**ï¼šé›†æˆStripeæˆ–å…¶ä»–æ”¯ä»˜ç½‘å…³
5. **è®¢é˜…åˆ†æ**ï¼šæ·»åŠ è®¢é˜…è½¬åŒ–ç‡å’Œç•™å­˜ç‡ç»Ÿè®¡

---

ç”Ÿæˆæ—¶é—´ï¼š2025-11-17
ç‰ˆæœ¬ï¼šv1.0
